#!/usr/bin/env bash
# subliminal-backup â€” download missing subtitles as a Bazarr fallback
#
# Usage:
#   subliminal-backup /path/to/file.mkv
#   subliminal-backup /mnt/pool/tv/Show\ Name/Season\ 1/
#
# Credentials: ~/.config/subliminal/credentials

set -euo pipefail

CREDS_FILE="${HOME}/.config/subliminal/credentials"

if [[ ! -f "$CREDS_FILE" ]]; then
    echo "Error: credentials file not found: $CREDS_FILE"
    echo "Create it with:"
    echo "  OPENSUBTITLES_USER=your_username"
    echo "  OPENSUBTITLES_PASS=your_password"
    exit 1
fi

# shellcheck source=/dev/null
source "$CREDS_FILE"

TARGET="${1:?Usage: $(basename "$0") /path/to/file/or/dir}"

subliminal download \
    --opensubtitles "$OPENSUBTITLES_USER" "$OPENSUBTITLES_PASS" \
    -l en \
    -p opensubtitles \
    -p podnapisi \
    "$TARGET"
